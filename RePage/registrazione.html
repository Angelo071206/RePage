<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrazione</title>
  <style>
    body {
      background-color: #f2f2f2;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      color: #333;
    }
    .register-container {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      margin-top: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    .message {
      margin-top: 15px;
      font-size: 14px;
      height: 18px;
    }
    label {
      text-align: left;
      display: block;
      margin-top: 15px;
    }
    .terms-link {
      color: #4CAF50;
      cursor: pointer;
      text-decoration: underline;
    }
    .terms-link:hover {
      color: #388E3C;
    }
    .home-link {
      margin-top: 30px;
      display: block;
      text-decoration: none;
      color: #4CAF50;
      font-weight: bold;
    }
    .home-link:hover {
      text-decoration: underline;
    }
    #termsPopup {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.5);
      overflow-y: auto;
    }
    #termsContent {
      background: white;
      margin: 40px auto;
      padding: 20px 30px;
      border-radius: 8px;
      max-width: 600px;
      position: relative;
    }
    #termsContent h1, #termsContent h2 {
      margin-top: 0;
    }
    #termsContent p {
      margin-bottom: 15px;
      line-height: 1.4;
    }
    #closeTerms {
      position: absolute;
      top: 10px;
      right: 15px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 18px;
      width: 30px;
      height: 30px;
      cursor: pointer;
      line-height: 1;
    }
    #closeTerms:hover {
      background: #d32f2f;
    }
  </style>
</head>
<body>

<div class="register-container">
  <h1>Crea il tuo account</h1>
  <form id="registerForm" autocomplete="off">
    <label for="nome">Nome</label>
    <input type="text" id="nome" required placeholder="Inserisci il tuo nome" />
    
    <label for="cognome">Cognome</label>
    <input type="text" id="cognome" required placeholder="Inserisci il tuo cognome" />
    
    <label for="email">Email</label>
    <input type="email" id="email" required placeholder="Inserisci la tua email" />
    
    <label for="password">Password</label>
    <input type="password" id="password" required placeholder="Inserisci la tua password" />

    <div style="margin-top:10px; text-align:left;">
      <input type="checkbox" id="accettoTermini" required />
      <label for="accettoTermini" style="display:inline;">
        Accetto i <span class="terms-link" id="openTerms">termini e condizioni</span>
      </label>
    </div>

    <button type="submit">Registrati</button>
  </form>
  <div id="message" class="message"></div>
  <a href="index.php" class="home-link">Torna alla Homepage</a>
</div>

<!-- Popup termini -->
<div id="termsPopup" aria-hidden="true">
  <div id="termsContent">
    <button id="closeTerms" aria-label="Chiudi popup">&times;</button>
    <h1 id="termsTitle">Termini e Condizioni di Utilizzo - RePage</h1>

    <section id="gdpr">
      <h2>3.1 General Data Protection Regulation (GDPR)</h2>
      <p>RePage è conforme al GDPR UE 2016/679 garantendo all’utente di consentire esplicitamente il trattamento dei propri dati personali (es. nome, cognome, indirizzo mail), che sono crittografati e accessibili solo al personale autorizzato.</p>
      <p>I dati raccolti sono nome, cognome, indirizzo mail e password, al fine di garantire l’affidabilità degli utenti che usufruiscono della piattaforma.</p>
      <p>I dati verranno conservati per tre anni a partire dall’ultimo login.</p>
      <p>Ciascun utente può accedere, modificare o cancellare i propri dati in qualsiasi momento.</p>
      <p>Secondo l’articolo 24 - Responsabilità del titolare del trattamento, RePage adotta la crittografia dei dati per garantire che questi non siano accessibili da terzi non autorizzati.</p>
      <p>Conformemente all’articolo 32, RePage protegge i dati personali contro rischi come distruzione, perdita, modifica o divulgazione non autorizzata, utilizzando misure di sicurezza quali crittografia e pseudonominizzazione.</p>
    </section>

    <section id="dsa">
      <h2>3.2 Digital Service Act (DSA)</h2>
      <p>RePage è conforme al DSA del 2022, garantendo il monitoraggio dei contenuti e intervenendo in caso di contenuti illeciti tramite la loro rimozione.</p>
      <p>Gli utenti possono contattare gli amministratori per segnalazioni o reclami secondo la normativa vigente.</p>
    </section>

    <section id="copyright">
      <h2>3.3 Copyright</h2>
      <p>RePage rispetta la normativa sul copyright (Legge 22 aprile 1941, n. 633).</p>
      <p>Gli utenti che pubblicano contenuti dichiarano di essere titolari dei diritti necessari o di averne ottenuto il permesso.</p>
      <p>Tutti i diritti relativi alla piattaforma (software, design, materiali protetti) sono proprietà di RePage e non possono essere copiati, modificati, distribuiti o utilizzati senza autorizzazione.</p>
      <p>Gli utenti si impegnano a non caricare contenuti che violino diritti di proprietà di terzi.</p>
      <p>RePage non è responsabile per i contenuti caricati dagli utenti ma agisce per garantire il rispetto dei diritti di proprietà intellettuale.</p>
    </section>

    <section id="qualita">
      <h2>3.4 Qualità</h2>
      <p>RePage è conforme alla norma UNI EN ISO 9001:2015 per la gestione della qualità e segue gli standard ISO/IEC 9126 (ora ISO 25000) per definire le caratteristiche di qualità del software.</p>
      <p>Per lo sviluppo software, RePage segue la normativa ISO/IEC 15504:2011.</p>
    </section>

    <section id="sicurezza">
      <h2>3.5 Sicurezza</h2>
      <p>RePage è conforme alla normativa ISO/IEC 27000 e agli standard ISO/IEC 27001 per la gestione della sicurezza delle informazioni e ISO/IEC 27002 per i controlli di sicurezza nella trasmissione dati.</p>
    </section>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
(() => {
  const key = CryptoJS.enc.Utf8.parse("12345678901234567890123456789012");
  const iv = CryptoJS.enc.Utf8.parse("1234567890123456");

  document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const messageEl = document.getElementById('message');
    messageEl.style.color = 'red';
    messageEl.textContent = '';

    const nome = document.getElementById('nome').value.trim();
    const cognome = document.getElementById('cognome').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    if (password.length < 8) {
      messageEl.textContent = 'La password deve avere almeno 8 caratteri.';
      return;
    }

    const encrypted = CryptoJS.AES.encrypt(password, key, {
      iv: iv,
      mode: CryptoJS.mode.CBC,
      padding: CryptoJS.pad.Pkcs7
    }).toString();

    const payload = { nome, cognome, email, password: encrypted };

    try {
      const response = await fetch('api/register.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await response.json();
      if (response.ok && data.message) {
        messageEl.style.color = 'green';
        messageEl.textContent = data.message;
        setTimeout(() => window.location.href = 'index.php', 1500);
      } else {
        messageEl.textContent = data.error || 'Errore durante la registrazione';
      }
    } catch {
      messageEl.textContent = 'Errore di rete o server.';
    }
  });

  const openTermsBtn = document.getElementById('openTerms');
  const termsPopup = document.getElementById('termsPopup');
  const closeTermsBtn = document.getElementById('closeTerms');

  openTermsBtn.addEventListener('click', () => {
    termsPopup.style.display = 'block';
    termsPopup.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  });

  closeTermsBtn.addEventListener('click', () => {
    termsPopup.style.display = 'none';
    termsPopup.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  });

  termsPopup.addEventListener('click', (e) => {
    if (e.target === termsPopup) {
      termsPopup.style.display = 'none';
      termsPopup.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === "Escape" && termsPopup.style.display === 'block') {
      termsPopup.style.display = 'none';
      termsPopup.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
  });
})();
</script>

</body>
</html>
